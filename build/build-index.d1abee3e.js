var isWarping=!1,randomWarpsEnabled=!0;const EMERALD_CURRENT_BANK=33763044,EMERALD_CURRENT_MAP=33763045,EMERALD_CURRENT_WARP=33763046;var flagManager;const SPEEDUP_HACKS_MODE={ON:2,BATTLE_ONLY:1,OFF:0};var speedupHackState=SPEEDUP_HACKS_MODE.ON;function setSpeedupHackState(e){e==SPEEDUP_HACKS_MODE.ON?(bypassWait=!0,speedupHackState=SPEEDUP_HACKS_MODE.ON):e==SPEEDUP_HACKS_MODE.BATTLE_ONLY?(bypassWait=!1,speedupHackState=SPEEDUP_HACKS_MODE.BATTLE_ONLY):e==SPEEDUP_HACKS_MODE.OFF&&(bypassWait=!1,speedupHackState=SPEEDUP_HACKS_MODE.OFF)}async function disableBypassWait(){bypassWait=!1,await delay(500),bypassWait=!0}var usingHomeWarp=!1;GameBoyAdvanceCPU.prototype.write32WithoutIntercept=GameBoyAdvanceCPU.prototype.write32,GameBoyAdvanceCPU.prototype.write32=function(e,t){if(33786972==e&&speedupHackState==SPEEDUP_HACKS_MODE.ON?-1==t&&disableBypassWait():33685508==e?t=0:33706852==e&&speedupHackState==SPEEDUP_HACKS_MODE.BATTLE_ONLY&&(bypassWait=!0),usingHomeWarp&&33763044==e)return this.write8(33763044,0),this.write8(33763045,9),this.write8(33763046,1),void(usingHomeWarp=!1);this.write32WithoutIntercept(e,t)},GameBoyAdvanceCPU.prototype.write8WithoutIntercept=GameBoyAdvanceCPU.prototype.write8,GameBoyAdvanceCPU.prototype.write8=function(e,t){33763046==e?isWarping=randomWarpsEnabled||forceNextWarp:33705742==e&&0!=t&&speedupHackState==SPEEDUP_HACKS_MODE.BATTLE_ONLY&&(bypassWait=!1),this.write8WithoutIntercept(e,t)};const EMERALD_MOVEMENT_MODE_OFFSET=33781136,FIRE_RED_MOVEMENT_MODE_OFFSET=33779832,MOVEMENT_MODE_WALK=1,MOVEMENT_MODE_BIKE=2,MOVEMENT_MODE_SURF=8;var teleportAnywhere=!1;GameBoyAdvanceCPU.prototype.read8WithoutIntercept=GameBoyAdvanceCPU.prototype.read8,GameBoyAdvanceCPU.prototype.read8=function(e){return isWarping?(33763044==e&&(e=this.handleWarpRedirection(e,IodineGUI.Iodine.IOCore.cartridge.romCode)),this.read8WithoutIntercept(e)):this.read8WithoutIntercept(e)};var reverseNextWarp=!1,forceNextWarp=null;function specialWarpHandling(e){let t=e.toRomCode+","+e.toBank+","+e.toMap+","+e.toWarpNo;if("E,8,1,0"==t){writeGameVar(16517,readGameVar(16517)<2?0:6)}else"E,16,0,0"==t?writeGameVar(16540,0):"E,16,0,1"==t||"E,16,1,0"==t?writeGameVar(16540,1):"E,16,1,1"==t||"E,16,2,0"==t?writeGameVar(16540,2):"E,16,2,1"==t||"E,16,3,0"==t?writeGameVar(16540,3):"E,16,3,1"==t?writeGameVar(16540,4):"E,10,0,0"==t&&(new FlagManager).setFlag(IodineGUI.Iodine.IOCore.cpu.read32(EMERALD_SAVE_1_PTR),4720,913,0)}GameBoyAdvanceCPU.prototype.handleWarpRedirection=function(e,t){let a=this.read8WithoutIntercept(e),r=this.read8WithoutIntercept(e+1),i=this.read8WithoutIntercept(e+2);if(255==i)return t+","+a+","+r+","+i=="E,8,1,255"&&(writeGameVar(16517,6),modifyBaseFlag(726,1),modifyBaseFlag(866,1)),e;let o=null,n=t+","+a+","+r+","+i;if(forceNextWarp){let e=forceNextWarp.split(",");o=new PKWarp(n,e[0],e[1],e[2],e[3],forceNextWarp),reverseNextWarp=!1,forceNextWarp=null}else if(reverseNextWarp&&warpList.get(n)){let e=warpList.get(n).source,t=e.split(",");o=new PKWarp(n,t[0],t[1],t[2],t[3],e),reverseNextWarp=!1}else o=warpList.get(n),console.log("Warping triggered for "+n);return o?(this.write8(33763044,o.toBank),this.write8(33763045,o.toMap),this.write8(33763046,o.toWarpNo),specialWarpHandling(o),console.log("Warping sending to "+o.toRomCode+","+o.toBank+","+o.toMap+","+o.toWarpNo)):console.log("Warping sending to vanilla"),isWarping=!1,e};const MAP_TYPE_ADDRESS=33783599,MAP_TYPES={NONE:0,TOWN:1,CITY:2,ROUTE:3,UNDERGROUND:4,UNDERWATER:5,OCEAN_ROUTE:6,UNKNOWN:7,INDOOR:8,SECRET_BASE:9};function isMapOutside(){let e=IodineGUI.Iodine.IOCore.cpu.read8(33783599);return e==MAP_TYPES.NONE||e==MAP_TYPES.TOWN||e==MAP_TYPES.CITY||e==MAP_TYPES.ROUTE||e==MAP_TYPES.UNDERWATER||e==MAP_TYPES.OCEAN_ROUTE}GameBoyAdvanceMultiCartridge.prototype.readROM16WithoutIntercept=GameBoyAdvanceMultiCartridge.prototype.readROM16,GameBoyAdvanceMultiCartridge.prototype.readROM16=function(e){return 761720==e&&(console.log("Destination to escape warp"),isMapOutside()&&(usingHomeWarp=!0)),this.readROM16WithoutIntercept(e)};var currentlySaving=!1;async function saveAfterDelay(){await delay(200),IodineGUI.Iodine.exportSave()}GameBoyAdvanceMultiCartridge.prototype.readROM8WithoutIntercept=GameBoyAdvanceMultiCartridge.prototype.readROM8,GameBoyAdvanceMultiCartridge.prototype.readROM8=function(e){return currentlySaving&&(3084361!=e&&8455992!=e||(console.log("saved"),saveAfterDelay(),currentlySaving=!1)),this.readROM8WithoutIntercept(e)},GameBoyAdvanceSaves.prototype.saveIntercept=function(e,t){0==e&&48==t&&(currentlySaving=!0)};const EMERALD_SAVE_1_PTR=50351276,EMERALD_SAVE_2_PTR=50351280,EMERALD_BASE_FLAGS_OFFSET=4720,EMERALD_SYS_FLAGS_OFFSET=4988,EMERALD_BADGE1_OFFSET=7,EMERALD_BADGE2_OFFSET=8,EMERALD_BADGE3_OFFSET=9,EMERALD_BADGE4_OFFSET=10,EMERALD_BADGE5_OFFSET=11,EMERALD_BADGE6_OFFSET=12,EMERALD_BADGE7_OFFSET=13,EMERALD_BADGE8_OFFSET=14,EMERALD_RUNNING_SHOE_OFFSET=96,EMERALD_POKEDEX_OFFSET=1,EMERALD_NATIONAL_DEX_OFFSET=54,EMERALD_BADGE_OFFSETS=[7,8,9,10,11,12,13,14],EMERALD_BASE_VAR_OFFSET=5020,EMERALD_STARTER_CHOICE_OFFSET=16419;function FlagManager(){this.badge1=null,this.badge2=null,this.badge3=null,this.badge4=null,this.badge5=null,this.badge6=null,this.badge7=null,this.badge8=null,this.hasRunningShoes=null}function modifyBadge(e,t){modifySystemFlag(EMERALD_BADGE_OFFSETS[e-1],t)}function modifyRunningShoes(e){modifySystemFlag(96,e)}function modifySystemFlag(e,t){let a=new FlagManager;a.readFlags();let r=EMERALD_SAVE_1_PTR,i=IodineGUI.Iodine.IOCore.cpu.read32(r);a.setFlag(i,4988,e,t)}function modifyBaseFlag(e,t){let a=new FlagManager;a.readFlags();let r=EMERALD_SAVE_1_PTR,i=IodineGUI.Iodine.IOCore.cpu.read32(r);a.setFlag(i,4720,e,t)}function readSystemFlag(e){let t=new FlagManager;t.readFlags(game);let a=EMERALD_SAVE_1_PTR,r=IodineGUI.Iodine.IOCore.cpu.read32(a);return t.getFlag(r,4988,e)}function writeGameVar(e,t){let a=EMERALD_SAVE_1_PTR,r=IodineGUI.Iodine.IOCore.cpu.read32(a);IodineGUI.Iodine.IOCore.cpu.write16(r+5020+2*(e-16384),t)}function readGameVar(e){let t=EMERALD_SAVE_1_PTR,a=IodineGUI.Iodine.IOCore.cpu.read32(t);return IodineGUI.Iodine.IOCore.cpu.read16(a+5020+2*(e-16384))}FlagManager.prototype.getFlag=function(e,t,a){let r=a%8;return!!+IodineGUI.Iodine.IOCore.cpu.read8(e+t+Math.ceil((a+1)/8)-1).toString(2).padStart(8,0).split("").reverse()[r]},FlagManager.prototype.setFlag=function(e,t,a,r){let i=a%8,o=IodineGUI.Iodine.IOCore.cpu.read8(e+t+Math.ceil((a+1)/8)-1).toString(2).padStart(8,0).split("").reverse();o[i]=r,IodineGUI.Iodine.IOCore.cpu.write8(e+t+Math.ceil((a+1)/8)-1,parseInt(o.reverse().join(""),2))},FlagManager.prototype.readFlags=function(){let e=IodineGUI.Iodine.IOCore.cpu.read32(EMERALD_SAVE_1_PTR);this.badge1=this.getFlag(e,4988,7),this.badge2=this.getFlag(e,4988,8),this.badge3=this.getFlag(e,4988,9),this.badge4=this.getFlag(e,4988,10),this.badge5=this.getFlag(e,4988,11),this.badge6=this.getFlag(e,4988,12),this.badge7=this.getFlag(e,4988,13),this.badge8=this.getFlag(e,4988,14),this.hasRunningShoes=this.getFlag(e,4988,96)},FlagManager.prototype.writeFlags=function(){let e=IodineGUI.Iodine.IOCore.cpu.read32(EMERALD_SAVE_1_PTR);this.setFlag(e,4988,96,+this.hasRunningShoes),this.setFlag(e,4720,228,1),modifySystemFlag(43,0)};
//# sourceMappingURL=build-index.d1abee3e.js.map
